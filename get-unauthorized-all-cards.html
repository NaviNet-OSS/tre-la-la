<html>
    <head>
        <title>Authorize test</title>
        <!-- The client library requires jQuery  -->
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="https://api.trello.com/1/client.js?key=f5613f90a2a2b7b56334453aeff8f858"></script>        
        <script src="http://trello-cfd.azurewebsites.net/bundles/highcharts?v=5k1FR7lWLeCY4R3SEEXFlV_mvXFFun6m07oIcBlI_4w1"></script>
    </head>
    <body>
        <input type="text" id="token-field">
        <div id="win"></div>
        <script>
            var board = '53284c2e0f453a7927d9bcd3';
            var params = {
                actions: 'all'
            };
            Trello.get('boards/' + board + '/lists')
                  .success(function(queryResult) {
                    listNames = $.map(queryResult, function(list, idx) {
                        return list.name;
                    });
                  });
                  
            Trello.get('boards/'+ board + '/cards/all', params)
                  .success(function(queryResult) { 
                    cards = queryResult; 
                    
                    cardActions = $.map(queryResult, function(card, idx) {
                        return $.map(card.actions, function(cardAction, idxAction) {
                            if(cardAction.data.listBefore) {
                                return { name: card.name, id: card.id, date: cardAction.date, newColumn: cardAction.data.listAfter.name };
                            } else {
                                return null;
                            }
                        });
                    });
            
            // data points
            categories = $.map(cardActions, function(cardAction, idx) { return cardAction.date; });
            
            series = $.map(listNames, function(listName, idx) {
                var x = $.map(categories, function(categoryName, idx2) {
                   return $.grep(cardActions, function(cardAction) { 
                        return cardAction.newColumn === listName && cardAction.date == categoryName; }).length;
                });
                return {name: listName, data: x};
            });
                    ////////////
                    
                    var chart;
        $(document).ready(function() {
            chart = new Highcharts.Chart({
                chart: {
                    renderTo: 'win',
                    type: 'area'
                },
                title: {
                    text: 'Tre-la-la'
                },
                xAxis: {
                    categories: categories,
                    tickmarkPlacement: 'on',
                    title: {
                        enabled: false
                    }
                },
                yAxis: {
                    title: {
                        text: 'Cards'
                    }
                },
                tooltip: {
                    formatter: function() {
                        return ''+
                            this.x +': '+ this.y;
                    }
                },
                plotOptions: {
                    area: {
                        stacking: 'normal',
                        lineColor: '#666666',
                        lineWidth: 1,
                        marker: {
                            lineWidth: 1,
                            lineColor: '#666666'
                        }
                    }
                },
                series: series
            });
        });
                    ///////////
                    
                    
                    
                    
                  });

        </script>
    </body>
</html>